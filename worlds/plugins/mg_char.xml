<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Donnerstag, September 21, 2023, 8:47  -->
<!-- MuClient version 5.01 -->

<!-- Plugin "mg_vitals" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mg_char"
   author="Viktor Kratz"
   id="267745b27b2f0e42200da929"
   language="Lua"
   purpose="Gets and saves char data of the morgengrauen mud."
   date_written="2023-09-21 20:47:05"
   requires="5.01"
   version="1.0"
   >

</plugin>
<script>
<![CDATA[
require "json"
local gmcp_handler_id ="ee38f102d1e8014f681df982"
function OnPluginBroadcast (msg, id, name, data)
if(id==gmcp_handler_id and msg==2 ) then
addCharPackage()
end -- Add package if
if(id==gmcp_handler_id and msg==1 ) then
startNr, endNr, subpackage,gmcpJson=string.find(data,"^%s*MG.char\.(vitals)%s*({.*})%s*$")
if subpackage=="vitals" then
decoded=json.decode(gmcpJson)

SetVariable("hp",decoded.hp)
SetVariable("sp",decoded.sp)
SetVariable("poison",decoded.poison)
BroadcastPlugin(1, gmcpJson)
end -- nil check if
end -- GMCP message If 
end -- function
function OnPluginInstall ()
addCharPackage()
end -- Function
function addCharPackage()
world.CallPlugin (gmcp_handler_id, "AddGMCPPackage", "MG.char 1")
end
]]>
</script>
</muclient>
