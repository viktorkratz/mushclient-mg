<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sonntag, September 24, 2023, 8:25  -->
<!-- MuClient version 5.01 -->

<!-- Plugin "mg_rooms" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mg_rooms"
   author="Viktor Kratz"
   id="13292fe3403d8b28f77bf5ac"
   language="Lua"
   purpose="Provides room data."
   date_written="2023-09-24 20:24:40"
   requires="5.01"
   version="1.0"
   >

</plugin>

<script>
<![CDATA[
require "json"
local gmcp_handler_id ="ee38f102d1e8014f681df982"
function OnPluginBroadcast (msg, id, name, data)
if(id==gmcp_handler_id and msg==2 ) then
addRoomPackage()
end -- if new GMCP data
if(id==gmcp_handler_id and msg==1 ) then
startNr, endNr, subpackage,gmcpJson=string.find(data,"^%s*MG.room\.(info)%s*({.*})%s*$")
if subpackage=="info" then
decoded=json.decode(gmcpJson)
SetVariable("id",decoded.id)
SetVariable("short",decoded.short)
SetVariable("domain",decoded.domain)
SetVariable("roomJSON",gmcpJson)
BroadcastPlugin(1, gmcpJson)
end -- if info subpackage
end -- if GMCP data
end -- End of OnPluginBroadcast

function OnPluginInstall ()
addRoomPackage()
end -- OnPluginInstall

function addRoomPackage()
CallPlugin (gmcp_handler_id, "AddGMCPPackage", "MG.room 1")
end -- function addRoomPackage
]]>
</script>
</muclient>
